#!/bin/sh

rm -rf deploy
mkdir deploy
git clone https://github.com/posthog/posthog deploy
cd deploy

if [ "$APP_ENV" = "staging" ]; then
	git checkout master -q
elif [ "$APP_ENV" = "production" ]; then
	git checkout $(git describe --tags $(git rev-list --tags --max-count=1)) -q
else
	echo "APP_ENV is not set correctly."
    exit 1
fi

cd ..
cp -r multi_tenancy deploy/

cat multi_tenancy_settings.py >>deploy/posthog/settings.py
cat requirements.txt >>deploy/requirements.txt
